import{_ as n,c as s,o as a,a as e}from"./app-u5Fl-cS_.js";const p="/assets/image1-Sr6jKuAw.png",t="/assets/image2-aHDk33We.png",o="/assets/image3-BR8RUvm5.png",l="data:image/png;base64,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",c="/assets/image5-DWeERbqO.png",i="/assets/image6-DUjogy4L.png",u="data:image/png;base64,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",r={},d=e('<h1 id="build-resp-api-s-for-file-interactions" tabindex="-1"><a class="header-anchor" href="#build-resp-api-s-for-file-interactions"><span>Build RESP-API&#39;s for file interactions</span></a></h1><p>Our application will provide APIs for:</p><table><thead><tr><th>Methode</th><th>Url</th><th>Action</th></tr></thead><tbody><tr><td>POST</td><td><code>/upload</code></td><td>upload a file</td></tr><tr><td>GET</td><td><code>/files</code></td><td>get list of files (name &amp; url)</td></tr><tr><td>GET</td><td><code>/files/[filename]</code></td><td>download a file</td></tr><tr><td>DELETE</td><td><code>/files/[filename]</code></td><td>delete a file</td></tr></tbody></table><h2 id="project-structure" tabindex="-1"><a class="header-anchor" href="#project-structure"><span>Project structure</span></a></h2><p>This is the project structure that we are aiming for:</p><p><img src="'+p+`" alt="image"></p><ul><li><code>resources/static/assets/uploads</code>: folder for storing uploaded files.</li><li><code>middleware/upload.js</code>: initializes Multer Storage engine and defines middleware function to save uploaded files in uploads folder.</li><li><code>file.controller.js</code> exports Rest APIs: POST a file, GET all filesâ€™ information, download a File with url.</li><li><code>routes/index.js</code>: defines routes for endpoints that is called from HTTP Client, use controller to handle requests.</li><li><code>server.js</code>: initializes routes, runs Express app.</li></ul><h2 id="installing-dependencies" tabindex="-1"><a class="header-anchor" href="#installing-dependencies"><span>Installing dependencies</span></a></h2><p>We will be installing the following dependencies:</p><ul><li>Multer (handeling multipart/form-data along with uploading files)</li><li>Cors (allowing Cross-origin resource sharing)</li></ul><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">npm</span> <span class="token function">install</span> multer cors // along with express ofcourse</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="uploading-and-downloading" tabindex="-1"><a class="header-anchor" href="#uploading-and-downloading"><span>Uploading and downloading</span></a></h2><h3 id="create-middleware-for-file-upload" tabindex="-1"><a class="header-anchor" href="#create-middleware-for-file-upload"><span>Create middleware for file upload</span></a></h3><p>Now we create the middleware for file upload by creating the <code>upload.js</code> file :</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token keyword">const</span> util <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;util&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// for node.js 5</span></span>
<span class="line"><span class="token keyword">const</span> multer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;multer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> util <span class="token function">from</span> <span class="token punctuation">(</span><span class="token string">&#39;util&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// for node.js 6</span></span>
<span class="line"><span class="token keyword">import</span> multer <span class="token function">from</span> <span class="token punctuation">(</span><span class="token string">&#39;multer&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> maxSize <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">let</span> storage <span class="token operator">=</span> multer<span class="token punctuation">.</span><span class="token function">diskStorage</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// folder to store the uploaded files</span></span>
<span class="line">  <span class="token function-variable function">destination</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> file<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> __basedir <span class="token operator">+</span> <span class="token string">&quot;/resources/static/assets/uploads/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token comment">// name of the file inside the destination folder</span></span>
<span class="line">  <span class="token function-variable function">filename</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> file<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>originalname<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> file<span class="token punctuation">.</span>originalname<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">let</span> uploadFile <span class="token operator">=</span> <span class="token function">multer</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">storage</span><span class="token operator">:</span> storage<span class="token punctuation">,</span></span>
<span class="line">  <span class="token comment">// limit the size of the file</span></span>
<span class="line">  <span class="token literal-property property">limits</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">fileSize</span><span class="token operator">:</span> maxSize <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">single</span><span class="token punctuation">(</span><span class="token string">&quot;file&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// make sure the middleware can be used with the ASYNC/AWAIT</span></span>
<span class="line"><span class="token keyword">let</span> uploadFileMiddleware <span class="token operator">=</span> util<span class="token punctuation">.</span><span class="token function">promisify</span><span class="token punctuation">(</span>uploadFile<span class="token punctuation">)</span><span class="token punctuation">;</span> </span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> uploadFileMiddleware<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container tip"><p class="hint-container-title">ðŸ’¡Tip</p><p>The name <code>file</code> in <code>.single(&quot;file&quot;)</code> is the name you give to the inputfield in your form. When testing this with Postman you also need give the key this name.</p></div><h3 id="create-controller-for-file-upload-download" tabindex="-1"><a class="header-anchor" href="#create-controller-for-file-upload-download"><span>Create controller for file upload/download</span></a></h3><p>In controller folder, create <code>file.controller.js</code>:</p><ul><li><p>For File Upload method, we will export <code>upload()</code> function that:</p><ul><li>use middleware function for file upload</li><li>catch Multer error (in middleware function)</li><li>return response with message</li></ul></li><li><p>For File Information and Download:</p><ul><li><code>getListFiles()</code>: read all files in uploads folder, return list of filesâ€™ information (name, url)</li><li><code>download()</code>: receives file name as input parameter, then uses Express res.download API to transfer the file at path (directory + file name) as an â€˜attachmentâ€™.</li></ul></li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token keyword">const</span> uploadFile <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../middleware/upload&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// for node.js 5</span></span>
<span class="line"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> uploadFile <span class="token function">from</span> <span class="token punctuation">(</span><span class="token string">&#39;../middleware/upload&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// for node.js 6</span></span>
<span class="line"><span class="token keyword">import</span> fs <span class="token function">from</span> <span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">upload</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">await</span> <span class="token function">uploadFile</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>file <span class="token operator">==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;Please upload a file!&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;Uploaded the file successfully: &quot;</span> <span class="token operator">+</span> req<span class="token punctuation">.</span>file<span class="token punctuation">.</span>originalname<span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// catch error for filesize limit to provide a specific response</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token string">&quot;LIMIT_FILE_SIZE&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;File size cannot be larger than 2MB!&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">Could not upload the file: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>req<span class="token punctuation">.</span>file<span class="token punctuation">.</span>originalname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">. </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>err<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">getListFiles</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> directoryPath <span class="token operator">=</span> __basedir <span class="token operator">+</span> <span class="token string">&quot;/resources/static/assets/uploads/&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  fs<span class="token punctuation">.</span><span class="token function">readdir</span><span class="token punctuation">(</span>directoryPath<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> files</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;Unable to scan files!&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">let</span> fileInfos <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    files<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      fileInfos<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">name</span><span class="token operator">:</span> file<span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">url</span><span class="token operator">:</span> directoryPath <span class="token operator">+</span> file<span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>fileInfos<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">download</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> fileName <span class="token operator">=</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>name<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> directoryPath <span class="token operator">=</span> __basedir <span class="token operator">+</span> <span class="token string">&quot;/resources/static/assets/uploads/&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  res<span class="token punctuation">.</span><span class="token function">download</span><span class="token punctuation">(</span>directoryPath <span class="token operator">+</span> fileName<span class="token punctuation">,</span> fileName<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;Could not download the file. &quot;</span> <span class="token operator">+</span> err<span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  upload<span class="token punctuation">,</span></span>
<span class="line">  getListFiles<span class="token punctuation">,</span></span>
<span class="line">  download<span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="define-route-for-uploading-file" tabindex="-1"><a class="header-anchor" href="#define-route-for-uploading-file"><span>Define route for uploading file</span></a></h3><p>When a client sends HTTP requests, we need to determine how the server will response by setting up the routes.</p><p>There are 3 routes with corresponding controller methods:</p><ul><li>POST <code>/upload</code>: <code>upload()</code></li><li>GET <code>/files</code>: <code>getListFiles()</code></li><li>GET <code>/files/[fileName]</code>: <code>download()</code></li></ul><p>Create index.js file inside <strong>routes</strong> folder with content like this:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// for node.js 5</span></span>
<span class="line"><span class="token keyword">import</span> express <span class="token function">from</span> <span class="token punctuation">(</span><span class="token string">&#39;express&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// for node.js 6</span></span>
<span class="line"><span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> controller <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../controller/file.controller&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// for node.js 5</span></span>
<span class="line"><span class="token keyword">import</span> controller <span class="token function">from</span> <span class="token punctuation">(</span><span class="token string">&#39;../controller/file.controller&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// for node.js 6</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">let</span> <span class="token function-variable function">routes</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">app</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/upload&quot;</span><span class="token punctuation">,</span> controller<span class="token punctuation">.</span>upload<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/files&quot;</span><span class="token punctuation">,</span> controller<span class="token punctuation">.</span>getListFiles<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/files/:name&quot;</span><span class="token punctuation">,</span> controller<span class="token punctuation">.</span>download<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> routes<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>You can see that we use controller from <code>file.controller.js</code>.</p><h3 id="create-express-app-server" tabindex="-1"><a class="header-anchor" href="#create-express-app-server"><span>Create Express app server</span></a></h3><p>Now we create our Express server in <code>server.js</code>:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token keyword">const</span> cors <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;cors&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// for node.js 5</span></span>
<span class="line"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> cors <span class="token function">from</span> <span class="token punctuation">(</span><span class="token string">&#39;cors&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// for node.js 6</span></span>
<span class="line"><span class="token keyword">import</span> express <span class="token function">from</span> <span class="token punctuation">(</span><span class="token string">&#39;express&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">global<span class="token punctuation">.</span>__basedir <span class="token operator">=</span> __dirname<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">var</span> corsOptions <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">origin</span><span class="token operator">:</span> <span class="token string">&quot;http://localhost:8081&quot;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cors</span><span class="token punctuation">(</span>corsOptions<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> initRoutes <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./src/routes&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">extended</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token function">initRoutes</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">let</span> port <span class="token operator">=</span> <span class="token number">8080</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">Running at localhost:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>What we do are:</p><ul><li>import <code>express</code> and <code>cors</code> modules: <ul><li>Express is for building the Rest apis</li><li>cors provides Express middleware to enable CORS with various options.</li></ul></li><li>create an Express app, then add <code>cors</code> middlewares using <code>app.use()</code> method. Notice that we set origin: <code>http://localhost:8081</code>.</li><li>listen on port 8080 for incoming requests.</li></ul><h3 id="run-test" tabindex="-1"><a class="header-anchor" href="#run-test"><span>Run &amp; Test</span></a></h3><p>First we need to create <strong>uploads</strong> folder with the path <code>resources/static/assets</code>. On the project root folder, run this command: <code>node server.js</code>.</p><ul><li>Letâ€™s use <strong>Postman</strong> to make HTTP POST request with a file:</li></ul><p><img src="`+t+'" alt="image"></p><ul><li>Upload a file with size larger than max file size (2MB):</li></ul><p><img src="'+o+'" alt="image"></p><ul><li>Check uploads folder after uploading several files:</li></ul><p><img src="'+l+'" alt="image"></p><ul><li>Retrieve list of Filesâ€™ information:</li></ul><p><img src="'+c+`" alt="image"></p><h2 id="deleting" tabindex="-1"><a class="header-anchor" href="#deleting"><span>Deleting</span></a></h2><p>Now that is working, let&#39;s look at deleting a file.</p><p>To delete a file in Node.js, we can use the <code>unlink()</code> function offered by the Node built-in fs module. The method doesnâ€™t block the Node.js event loop because it works asynchronously.</p><p>Here is an illustration showing how you can apply the technique:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// for node.js 5</span></span>
<span class="line"><span class="token keyword">import</span> fs <span class="token function">from</span> <span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// for node.js 6</span></span>
<span class="line"></span>
<span class="line">fs<span class="token punctuation">.</span><span class="token function">unlink</span><span class="token punctuation">(</span>directoryPath <span class="token operator">+</span> fileName<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">throw</span> err<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Delete File successfully.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="create-controller-for-file-delete" tabindex="-1"><a class="header-anchor" href="#create-controller-for-file-delete"><span>Create controller for file delete</span></a></h3><p>In controller folder, create <code>file.controller.js</code>:</p><p>We will export <code>remove()</code> function that:</p><ul><li>use <code>fs.unlink</code> function for deleting file by its name</li><li>return response with message</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// for node.js 5</span></span>
<span class="line"><span class="token keyword">import</span> fs <span class="token function">from</span> <span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// for node.js 6</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">remove</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> fileName <span class="token operator">=</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>name<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">const</span> directoryPath <span class="token operator">=</span> __basedir <span class="token operator">+</span> <span class="token string">&quot;/resources/static/assets/uploads/&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  fs<span class="token punctuation">.</span><span class="token function">unlink</span><span class="token punctuation">(</span>directoryPath <span class="token operator">+</span> fileName<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;Could not delete the file. &quot;</span> <span class="token operator">+</span> err<span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;File is deleted.&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  remove<span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="defining-route-for-deleting-file" tabindex="-1"><a class="header-anchor" href="#defining-route-for-deleting-file"><span>Defining route for deleting file</span></a></h3><p>When a client sends HTTP requests, we need to determine how the server will response by setting up the routes.</p><p>Here is route with corresponding controller method:</p><ul><li>DELETE <code>/files/[fileName]</code>: <code>remove()</code></li></ul><p>Create <code>index.js</code> file inside <strong>routes</strong> folder with content like this:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// for node.js 5</span></span>
<span class="line"><span class="token keyword">import</span> express <span class="token function">from</span> <span class="token punctuation">(</span><span class="token string">&#39;express&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// for node.js 6</span></span>
<span class="line"><span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> controller <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../controller/file.controller&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// for node.js 5</span></span>
<span class="line"><span class="token keyword">import</span> controller <span class="token function">from</span> <span class="token punctuation">(</span><span class="token string">&#39;../controller/file.controller&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// for node.js 6</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">let</span> <span class="token function-variable function">routes</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">app</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  router<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">&quot;/files/:name&quot;</span><span class="token punctuation">,</span> controller<span class="token punctuation">.</span>remove<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> routes<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>You can see that we use controller from <code>file.controller.js</code>.</p><h3 id="run-test-1" tabindex="-1"><a class="header-anchor" href="#run-test-1"><span>Run &amp; Test</span></a></h3><p>Letâ€™s use <strong>Postman</strong> to make HTTP DELETE request with a file name in url:</p><p><img src="`+i+'" alt="image"></p><p>Check the result:</p><p><img src="'+u+'" alt="image"></p>',64),k=[d];function m(v,f){return a(),s("div",null,k)}const h=n(r,[["render",m],["__file","index.html.vue"]]),g=JSON.parse(`{"path":"/53_rest_api_fileupload/","title":"Build RESP-API's for file interactions","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"Project structure","slug":"project-structure","link":"#project-structure","children":[]},{"level":2,"title":"Installing dependencies","slug":"installing-dependencies","link":"#installing-dependencies","children":[]},{"level":2,"title":"Uploading and downloading","slug":"uploading-and-downloading","link":"#uploading-and-downloading","children":[{"level":3,"title":"Create middleware for file upload","slug":"create-middleware-for-file-upload","link":"#create-middleware-for-file-upload","children":[]},{"level":3,"title":"Create controller for file upload/download","slug":"create-controller-for-file-upload-download","link":"#create-controller-for-file-upload-download","children":[]},{"level":3,"title":"Define route for uploading file","slug":"define-route-for-uploading-file","link":"#define-route-for-uploading-file","children":[]},{"level":3,"title":"Create Express app server","slug":"create-express-app-server","link":"#create-express-app-server","children":[]},{"level":3,"title":"Run & Test","slug":"run-test","link":"#run-test","children":[]}]},{"level":2,"title":"Deleting","slug":"deleting","link":"#deleting","children":[{"level":3,"title":"Create controller for file delete","slug":"create-controller-for-file-delete","link":"#create-controller-for-file-delete","children":[]},{"level":3,"title":"Defining route for deleting file","slug":"defining-route-for-deleting-file","link":"#defining-route-for-deleting-file","children":[]},{"level":3,"title":"Run & Test","slug":"run-test-1","link":"#run-test-1","children":[]}]}],"git":{"updatedTime":1699949338000,"contributors":[{"name":"Ronny Mees","email":"ronny.mees@vives.be","commits":3},{"name":"ronnymees","email":"ronny.mees@vives.be","commits":2}]},"filePathRelative":"53_rest_api_fileupload/README.md"}`);export{h as comp,g as data};
