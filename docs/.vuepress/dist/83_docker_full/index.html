<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.15" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #22272e;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (userMode === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (userMode === 'dark' || systemDarkMode) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <title>Deploy a MySQL, Express & Vue project | Course Web Scripting - Professional Bachelor Elektronica-ICT</title><meta name="description" content="Course Web Scripting">
    <link rel="preload" href="/assets/style-zZMpTrNR.css" as="style"><link rel="stylesheet" href="/assets/style-zZMpTrNR.css">
    <link rel="modulepreload" href="/assets/app-u5Fl-cS_.js"><link rel="modulepreload" href="/assets/index.html-Bkam1x2P.js">
    <link rel="prefetch" href="/assets/index.html-Bv6M9QxD.js" as="script"><link rel="prefetch" href="/assets/index.html-DjA55S5H.js" as="script"><link rel="prefetch" href="/assets/index.html-Bw0pMDRC.js" as="script"><link rel="prefetch" href="/assets/index.html-CJe85tg8.js" as="script"><link rel="prefetch" href="/assets/index.html-CK9aXbVr.js" as="script"><link rel="prefetch" href="/assets/index.html-C2T5SuiP.js" as="script"><link rel="prefetch" href="/assets/index.html-B48iAkrs.js" as="script"><link rel="prefetch" href="/assets/index.html-BcGc5IUF.js" as="script"><link rel="prefetch" href="/assets/index.html-evSi_XOB.js" as="script"><link rel="prefetch" href="/assets/index.html-CNIrOKlz.js" as="script"><link rel="prefetch" href="/assets/index.html-BWFi1OD7.js" as="script"><link rel="prefetch" href="/assets/index.html-87t-EkM3.js" as="script"><link rel="prefetch" href="/assets/index.html-Z1NeXTzV.js" as="script"><link rel="prefetch" href="/assets/index.html-B-5GaUXV.js" as="script"><link rel="prefetch" href="/assets/index.html-COM_uTzS.js" as="script"><link rel="prefetch" href="/assets/index.html-Cr2JcNBI.js" as="script"><link rel="prefetch" href="/assets/index.html-UnSiC5oP.js" as="script"><link rel="prefetch" href="/assets/index.html-DbfVK5mp.js" as="script"><link rel="prefetch" href="/assets/index.html-DP9rxP21.js" as="script"><link rel="prefetch" href="/assets/index.html-DLtPYpFr.js" as="script"><link rel="prefetch" href="/assets/index.html-DK7-cvo4.js" as="script"><link rel="prefetch" href="/assets/index.html-DS6lNZCy.js" as="script"><link rel="prefetch" href="/assets/index.html-0Ht9ae0I.js" as="script"><link rel="prefetch" href="/assets/index.html-BxA0dfn1.js" as="script"><link rel="prefetch" href="/assets/404.html-dJO-mpa7.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/"><img class="vp-site-logo" src="/files/afbeelding1.png" alt="Course Web Scripting - Professional Bachelor Elektronica-ICT"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">Course Web Scripting - Professional Bachelor Elektronica-ICT</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/" aria-label="Home"><!---->Home<!----></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://www.vives.be" aria-label="Organization" rel="noopener noreferrer" target="_blank"><!---->Organization<!----></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="mailto:jeroen.reinenbergh@vives.be" aria-label="Contact" rel="noopener noreferrer" target="_blank"><!---->Contact<!----></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/JeroenVives/EOICT_WebScripting" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!---->GitHub<!----></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/" aria-label="Home"><!---->Home<!----></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://www.vives.be" aria-label="Organization" rel="noopener noreferrer" target="_blank"><!---->Organization<!----></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="mailto:jeroen.reinenbergh@vives.be" aria-label="Contact" rel="noopener noreferrer" target="_blank"><!---->Contact<!----></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/JeroenVives/EOICT_WebScripting" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!---->GitHub<!----></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading collapsible">Development tools <span class="right arrow"></span></p><ul style="display:none;" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/01_developmenttools/" aria-label="Development Tools"><!---->Development Tools<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading collapsible">Backend databases <span class="right arrow"></span></p><ul style="display:none;" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/41_databases/" aria-label="Databases"><!---->Databases<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/42_setup_mysql/" aria-label="Setup MySQL database"><!---->Setup MySQL database<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/43_setup_mariadb/" aria-label="Setup MariaDB database"><!---->Setup MariaDB database<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/45_create_db_user/" aria-label="Creating a database with an application user"><!---->Creating a database with an application user<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/46_crud_db/" aria-label="CRUD interactions with a database"><!---->CRUD interactions with a database<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading collapsible">Backend scripting <span class="right arrow"></span></p><ul style="display:none;" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/51_intro_express/" aria-label="Intro into Express.js"><!---->Intro into Express.js<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/52_rest_api_crud/" aria-label="Build REST-API&#39;s for CRUD interactions"><!---->Build REST-API&#39;s for CRUD interactions<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/53_rest_api_fileupload/" aria-label="Build RESP-API&#39;s for file interactions"><!---->Build RESP-API&#39;s for file interactions<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/54_security/" aria-label="Backend security"><!---->Backend security<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading collapsible">Frontend development <span class="right arrow"></span></p><ul style="display:none;" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/61_frontend_vue/" aria-label="Frontend development with Vue"><!---->Frontend development with Vue<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/66_routes/" aria-label="Routes in Vue"><!---->Routes in Vue<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/62_restfull_apis/" aria-label="Call backend services through RESTful APIs"><!---->Call backend services through RESTful APIs<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/63_crud/" aria-label="Learning project: To-Do C.R.U.D. App"><!---->Learning project: To-Do C.R.U.D. App<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/64_axios/" aria-label="Axios a alternative to fetch"><!---->Axios a alternative to fetch<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/65_vuetify/" aria-label="Style your pages with Vuetify"><!---->Style your pages with Vuetify<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading collapsible">Privacy regulations <span class="right arrow"></span></p><ul style="display:none;" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/73_privacy/" aria-label="Privacy"><!---->Privacy<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading active collapsible">Deployment <span class="down arrow"></span></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/81_vm/" aria-label="Virtual Machine"><!---->Virtual Machine<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/82_docker_static/" aria-label="Deploy a HTML,CSS &amp; JS project"><!---->Deploy a HTML,CSS &amp; JS project<!----></a><!----></li><li><a class="route-link route-link-active auto-link vp-sidebar-item active" href="/83_docker_full/" aria-label="Deploy a MySQL, Express &amp; Vue project"><!---->Deploy a MySQL, Express &amp; Vue project<!----></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div class="theme-default-content" vp-content><!--[--><!--]--><div><h1 id="deploy-a-mysql-express-vue-project" tabindex="-1"><a class="header-anchor" href="#deploy-a-mysql-express-vue-project"><span>Deploy a MySQL, Express &amp; Vue project</span></a></h1><div class="hint-container warning"><p class="hint-container-title">🔥warning</p><p>Make sure you have prepared your VM before continuing here.</p></div><h2 id="prepare-your-project-for-deployment" tabindex="-1"><a class="header-anchor" href="#prepare-your-project-for-deployment"><span>Prepare your project for deployment</span></a></h2><p>To be able to deploy our web application on the VM we need to prepare it.</p><h3 id="create-a-github-repository-for-deployment" tabindex="-1"><a class="header-anchor" href="#create-a-github-repository-for-deployment"><span>Create a GitHub repository for deployment</span></a></h3><ul><li>create a new repository on github</li><li>create a local folder <code>&lt;projectname&gt;</code> with the subfolders <code>backend-api</code> and <code>frontend-vue</code>.</li><li>make a copy of your <strong>express</strong> project to the folder <code>backend-api</code>.</li><li>make a copy of your <strong>vue</strong> project to the folder <code>frontend-vue</code>.</li><li>open the folder <code>&lt;projectname&gt;</code> in Visual Code and open a terminal</li><li>make it a git repository by typing <code>git init</code>.</li><li>add the remote GitHub repository by typing <code>git remote add origin git@github.com:yourusername/repositoryname.git</code> (the last part is your SSH link from your GitHub repository)</li><li>make a first push</li></ul><h3 id="preparing-the-necessary-files-for-docker" tabindex="-1"><a class="header-anchor" href="#preparing-the-necessary-files-for-docker"><span>Preparing the necessary files for docker</span></a></h3><h4 id="docker-compose-file" tabindex="-1"><a class="header-anchor" href="#docker-compose-file"><span>Docker compose file</span></a></h4><p>First we will be creating the docker compose file that will contain the necessary services that need to be deployed on docker ( MySQL, PHPmyAdmin, Backend-API and Frontend-Vue).</p><p>Create a file <code>docker-compose.yml</code> in the folder <code>&lt;projectname&gt;</code> with the following content:</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&#39;3&#39;</span></span>
<span class="line"><span class="token key atrule">services</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">db</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql</span>
<span class="line">    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always</span>
<span class="line">    <span class="token key atrule">environment</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> MYSQL_ROOT_PASSWORD=$<span class="token punctuation">{</span>MYSQLDB_ROOT_PASSWORD<span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">-</span> MYSQL_DATABASE=$<span class="token punctuation">{</span>MYSQLDB_DATABASE<span class="token punctuation">}</span></span>
<span class="line">    <span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> db<span class="token punctuation">:</span>/var/lib/mysql</span>
<span class="line">  <span class="token key atrule">phpmyadmin</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> phpmyadmin/phpmyadmin</span>
<span class="line">    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always</span>
<span class="line">    <span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">&quot;8080:80&quot;</span></span>
<span class="line">    <span class="token key atrule">environment</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> PMA_ARBITRARY=1</span>
<span class="line">      <span class="token punctuation">-</span> PMA_HOST=db</span>
<span class="line">      <span class="token punctuation">-</span> PMA_USER=root</span>
<span class="line">      <span class="token punctuation">-</span> PMA_PASSWORD=$<span class="token punctuation">{</span>MYSQLDB_ROOT_PASSWORD<span class="token punctuation">}</span></span>
<span class="line">  <span class="token key atrule">api</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> db</span>
<span class="line">    <span class="token key atrule">build</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">context</span><span class="token punctuation">:</span> ./backend<span class="token punctuation">-</span>api</span>
<span class="line">      <span class="token key atrule">dockerfile</span><span class="token punctuation">:</span> Dockerfile</span>
<span class="line">    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always</span>
<span class="line">    <span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> 3000<span class="token punctuation">:</span><span class="token number">3000</span></span>
<span class="line">    <span class="token key atrule">environment</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> DB_HOST=db</span>
<span class="line">      <span class="token punctuation">-</span> DB_USER=$<span class="token punctuation">{</span>MYSQLDB_USER<span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">-</span> DB_PASS=$<span class="token punctuation">{</span>MYSQLDB_USER_PASS<span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">-</span> DB_NAME=$<span class="token punctuation">{</span>MYSQLDB_DATABASE<span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">-</span> DB_PORT=3306</span>
<span class="line">  <span class="token key atrule">ui</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span> </span>
<span class="line">       <span class="token punctuation">-</span> api</span>
<span class="line">    <span class="token key atrule">build</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">context</span><span class="token punctuation">:</span> ./frontend<span class="token punctuation">-</span>vue</span>
<span class="line">      <span class="token key atrule">dockerfile</span><span class="token punctuation">:</span> Dockerfile</span>
<span class="line">    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always</span>
<span class="line">    <span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token datetime number">80:80</span></span>
<span class="line">    <span class="token key atrule">environment</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> VUE_APP_API_HOST=&lt;your server ip<span class="token punctuation">-</span>adress<span class="token punctuation">&gt;</span><span class="token punctuation">:</span><span class="token number">3000</span></span>
<span class="line"><span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">db</span><span class="token punctuation">:</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Notice that the MySQL server port 3306 is not exposed, so our database is not accessable outside docker.</p><h4 id="docker-file-for-the-backend-api" tabindex="-1"><a class="header-anchor" href="#docker-file-for-the-backend-api"><span>Docker file for the backend API</span></a></h4><p>Create a file <code>Dockerfile</code> in the folder <code>backend-api</code> with the following content:</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token comment"># Development stage</span></span>
<span class="line">FROM node<span class="token punctuation">:</span>18.16<span class="token punctuation">-</span>alpine3.17 as develop<span class="token punctuation">-</span>stage</span>
<span class="line">WORKDIR /app</span>
<span class="line">COPY package<span class="token important">*.json</span> ./</span>
<span class="line">RUN npm install</span>
<span class="line">COPY . .</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Build stage</span></span>
<span class="line">FROM develop<span class="token punctuation">-</span>stage as build<span class="token punctuation">-</span>stage</span>
<span class="line">EXPOSE 3000</span>
<span class="line">CMD <span class="token punctuation">[</span><span class="token string">&quot;npm&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;run&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;start&quot;</span><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="docker-file-for-the-frontend-vue" tabindex="-1"><a class="header-anchor" href="#docker-file-for-the-frontend-vue"><span>Docker file for the frontend Vue</span></a></h4><p>Create a file <code>Dockerfile</code> in the folder <code>frontend-vue</code> with the following content:</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token comment"># Development Stage</span></span>
<span class="line">FROM node<span class="token punctuation">:</span>18.16<span class="token punctuation">-</span>alpine3.17 as develop<span class="token punctuation">-</span>stage</span>
<span class="line">WORKDIR /app</span>
<span class="line">COPY package<span class="token important">*.json</span> ./</span>
<span class="line">RUN npm install</span>
<span class="line">COPY . .</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Build Stage</span></span>
<span class="line">FROM develop<span class="token punctuation">-</span>stage as build<span class="token punctuation">-</span>stage</span>
<span class="line">RUN npm run build</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Production Stage</span></span>
<span class="line">FROM nginx<span class="token punctuation">:</span>1.25.1<span class="token punctuation">-</span>alpine as production<span class="token punctuation">-</span>stage</span>
<span class="line">COPY <span class="token punctuation">-</span><span class="token punctuation">-</span>from=build<span class="token punctuation">-</span>stage /app/dist /usr/share/nginx/html</span>
<span class="line">COPY nginx.conf /etc/nginx/nginx.conf</span>
<span class="line">COPY vue<span class="token punctuation">-</span>env<span class="token punctuation">-</span>replace.sh /docker<span class="token punctuation">-</span>entrypoint.d</span>
<span class="line">EXPOSE 80</span>
<span class="line">CMD <span class="token punctuation">[</span><span class="token string">&quot;nginx&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-g&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;daemon off;&quot;</span><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="hosting-configuration" tabindex="-1"><a class="header-anchor" href="#hosting-configuration"><span>Hosting configuration</span></a></h4><p>We are using <code>nginx</code> to host our frontend, therefore we need to configure it by adding a <code>nginx.conf</code> file in the <code>frontend-vue</code> folder with the following content:</p><div class="language-conf line-numbers-mode" data-highlighter="prismjs" data-ext="conf" data-title="conf"><pre><code><span class="line">user  nginx;</span>
<span class="line">worker_processes  1;</span>
<span class="line">error_log  /var/log/nginx/error.log warn;</span>
<span class="line">pid        /var/run/nginx.pid;</span>
<span class="line">events {</span>
<span class="line">  worker_connections  1024;</span>
<span class="line">}</span>
<span class="line">http {</span>
<span class="line">  include       /etc/nginx/mime.types;</span>
<span class="line">  default_type  application/octet-stream;</span>
<span class="line">  log_format  main  &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span>
<span class="line">                    &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span>
<span class="line">                    &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;</span>
<span class="line">  access_log  /var/log/nginx/access.log  main;</span>
<span class="line">  sendfile        on;</span>
<span class="line">  keepalive_timeout  65;</span>
<span class="line">  server {</span>
<span class="line">    listen       80;</span>
<span class="line">    server_name  localhost;</span>
<span class="line">    location / {</span>
<span class="line">      root /usr/share/nginx/html;</span>
<span class="line">      index  index.html;</span>
<span class="line">      try_files $uri $uri/ /index.html;</span>
<span class="line">    }</span>
<span class="line">    error_page   500 502 503 504  /50x.html;</span>
<span class="line">    location = /50x.html {</span>
<span class="line">      root   /usr/share/nginx/html;</span>
<span class="line">    }</span>
<span class="line">  }</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="push-to-your-github-repository" tabindex="-1"><a class="header-anchor" href="#push-to-your-github-repository"><span>Push to your GitHub repository</span></a></h3><p>Now your project is ready for deployment, you can push it to GitHub.</p><h2 id="clone-and-deploy-your-project" tabindex="-1"><a class="header-anchor" href="#clone-and-deploy-your-project"><span>Clone and deploy your project</span></a></h2><p>Now we will be using our GitHub repository for deployment on Docker.</p><h3 id="clone-your-repository-on-docker" tabindex="-1"><a class="header-anchor" href="#clone-your-repository-on-docker"><span>Clone your repository on docker</span></a></h3><p>Make a remote connection to your VM using Visual Studio Code.</p><p>Open a terminal and clone your repository:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">git</span> clone <span class="token operator">&lt;</span>https <span class="token function">link</span> repo<span class="token operator">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="environment-variables" tabindex="-1"><a class="header-anchor" href="#environment-variables"><span>Environment variables</span></a></h3><p>Open your projectfolder in remote connection of Visual Studio Code.</p><h4 id="create-the-environment-variables-file" tabindex="-1"><a class="header-anchor" href="#create-the-environment-variables-file"><span>Create the environment variables file</span></a></h4><p>Next we need to create a ´.env´ file in the folder <code>&lt;projectname&gt;</code> with the following content:</p><div class="language-env line-numbers-mode" data-highlighter="prismjs" data-ext="env" data-title="env"><pre><code><span class="line"># mySQL database</span>
<span class="line">MYSQLDB_ROOT_PASSWORD=&lt;your root password&gt;</span>
<span class="line">MYSQLDB_DATABASE=vives</span>
<span class="line">MYSQLDB_USER=&lt;a_user_for_your_database&gt;</span>
<span class="line">MYSQLDB_USER_PASS=&lt;a_password_for_this_user&gt;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="solve-a-problem-for-the-frontend" tabindex="-1"><a class="header-anchor" href="#solve-a-problem-for-the-frontend"><span>Solve a problem for the frontend</span></a></h4><p>For the Vue frontend we will have a problem that environment variables are injected into the application during the build stage. The resulting static files thus contain the respective values of those variables as hardcoded strings. To solve this we will use a script <code>vue-env-replace.sh</code> to replace all environment variables with there correct values.</p><p>You can please the <code>vue-env-replace.sh</code> in your <code>frontend-vue</code> folder with the following content:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token shebang important">#!/bin/sh</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;Replacing ENV vars before starting nginx&quot;</span></span>
<span class="line"><span class="token keyword">for</span> <span class="token for-or-select variable">file</span> <span class="token keyword">in</span> /usr/share/nginx/html/assets/*.js<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">do</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-f</span> <span class="token variable">$file</span>.tmpl.js <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">    <span class="token function">cp</span> <span class="token variable">$file</span> <span class="token variable">$file</span>.tmpl.js</span>
<span class="line">  <span class="token keyword">fi</span></span>
<span class="line">  envsubst <span class="token string">&#39;$VUE_APP_API_HOST&#39;</span> <span class="token operator">&lt;</span> <span class="token variable">$file</span>.tmpl.js <span class="token operator">&gt;</span> <span class="token variable">$file</span></span>
<span class="line"><span class="token keyword">done</span></span>
<span class="line"></span>
<span class="line"><span class="token builtin class-name">exit</span> <span class="token number">0</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Once you created this file, you will need to run the command <code>chmod +x vue-env-replace.sh</code> to make the script executable. The script will be executed by Docker because we have put it in the entrypoint.</p><h4 id="change-static-url-to-environment-variable" tabindex="-1"><a class="header-anchor" href="#change-static-url-to-environment-variable"><span>Change static URL to environment variable</span></a></h4><p>In your Vue frontend you need to change all <code>localhost:3000</code> to <code>${VUE_APP_API_HOST}</code>.</p><p>Example:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line">axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;http://${VUE_APP_API_HOST}/images&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="deploy-on-docker" tabindex="-1"><a class="header-anchor" href="#deploy-on-docker"><span>Deploy on docker</span></a></h3><p>Once we have done that, we are ready to build and run our service.</p><ul><li>use <code>docker-compose up -d</code> to deploy your container, now you get your bash prompt returned.</li><li>use <code>docker-compose up -d --build</code> to deploy your container and rebuild them after adjustments have been made.</li><li>use <code>docker-compose ps</code> to see the name of the containers and status.</li><li>use <code>docker-compose down</code> to stop and remove the docker containers.</li><li>use <code>docker-compose down -v</code> to stop and remove the docker containers and volumes.</li></ul><p><img src="/assets/containers-Bgzq_RLm.png" alt="containers">exit</p><p>Should you want to open a terminal in one of the containers running on docker, you can do this by using this command:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> <span class="token operator">&lt;</span>the name of the container<span class="token operator">&gt;</span> <span class="token function">sh</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>To exit just type <code>exit</code>.</p><h3 id="prepare-the-database" tabindex="-1"><a class="header-anchor" href="#prepare-the-database"><span>Prepare the database</span></a></h3><h4 id="create-a-user-for-the-application" tabindex="-1"><a class="header-anchor" href="#create-a-user-for-the-application"><span>Create a user for the application</span></a></h4><p>In your browser open PHPmyAdmin by surfing to <code>&lt;ip-adres-of-your-vm&gt;:8080</code> and run the following sql-statement:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">USE</span> vives<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">USER</span> <span class="token string">&#39;&lt;a_user_for_your_database&gt;&#39;</span><span class="token variable">@&#39;%&#39;</span> IDENTIFIED <span class="token keyword">WITH</span> mysql_native_password <span class="token keyword">BY</span> <span class="token string">&quot;&lt;a_password_for_this_user&gt;&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">GRANT</span> <span class="token keyword">ALL</span> <span class="token keyword">PRIVILEGES</span> <span class="token keyword">ON</span> vives<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> <span class="token string">&#39;&lt;a_user_for_your_database&gt;&#39;</span><span class="token variable">@&#39;%&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container tip"><p class="hint-container-title">💡tip</p><p>The user and password must be the same as you entered in your <code>.env</code> file.</p></div><h4 id="create-the-necessary-tables" tabindex="-1"><a class="header-anchor" href="#create-the-necessary-tables"><span>Create the necessary tables</span></a></h4><p>Run the SQL-statement script you made to restore your database tables.</p><p>Congratulations your project should be up and running now.</p></div><!--[--><!--]--></div><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link label" href="https://github.com/JeroenVives/EOICT_WebScripting/edit/master/docs/83_docker_full/README.md" aria-label="Edit this page" rel="noopener noreferrer" target="_blank"><!--[--><svg class="edit-icon" viewbox="0 0 1024 1024"><g fill="currentColor"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></g></svg><!--]-->Edit this page<!----></a></div><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="vp-meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: ronny.mees@vives.be">ronnymees</span><!----><!--]--><!--]--></span></div></div></footer><nav class="vp-page-nav" aria-label="page navigation"><a class="route-link auto-link prev" href="/82_docker_static/" aria-label="Deploy a HTML,CSS &amp; JS project"><div class="hint"><span class="arrow left"></span> Prev</div><div class="link"><span>Deploy a HTML,CSS &amp; JS project</span></div></a><!----></nav><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-u5Fl-cS_.js" defer></script>
  </body>
</html>
